{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }} - PIMS - Bangladesh Parliament Secretariat{% endblock %}

{% block extra_css %}
<style>
/* PIMS Office Create Template - Bangladesh Parliament Design System */
:root {
    --parliament-primary: #14b8a6;
    --parliament-secondary: #0f766e;
    --parliament-accent: #f97316;
    --parliament-danger: #ef4444;
    --parliament-success: #10b981;
    --parliament-warning: #f59e0b;
    --parliament-dark: #1e293b;
    --parliament-neutral: #64748b;
    --parliament-light: #f8fafc;
    --parliament-white: #ffffff;
    --parliament-border: #e2e8f0;
    --parliament-border-light: #f1f5f9;
    
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
    
    --border-radius: 12px;
    --border-radius-lg: 16px;
    --transition: all 0.3s ease;
    
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
}

/* Main Container */
.office-create-container {
    background: linear-gradient(135deg, var(--parliament-light) 0%, #e2e8f0 100%);
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

/* Header Section */
.page-header {
    background: var(--parliament-white);
    border: 1px solid var(--parliament-border);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-2xl);
    margin-bottom: var(--spacing-xl);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--parliament-primary), var(--parliament-accent));
}

.page-title {
    color: var(--parliament-dark);
    font-weight: 700;
    margin-bottom: var(--spacing-sm);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    font-size: 2rem;
}

.page-subtitle {
    color: var(--parliament-neutral);
    margin: 0;
    font-size: 1.125rem;
}

.breadcrumb-nav {
    margin-top: var(--spacing-md);
}

.breadcrumb {
    background: transparent;
    padding: 0;
    margin: 0;
}

.breadcrumb-item a {
    color: var(--parliament-primary);
    text-decoration: none;
    transition: var(--transition);
}

.breadcrumb-item a:hover {
    color: var(--parliament-secondary);
}

.breadcrumb-item.active {
    color: var(--parliament-neutral);
}

/* Form Container */
.form-container {
    background: var(--parliament-white);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--parliament-border);
    margin: 0 auto;
    max-width: 1000px;
}

.form-header {
    background: linear-gradient(135deg, var(--parliament-primary) 0%, var(--parliament-secondary) 100%);
    color: var(--parliament-white);
    padding: var(--spacing-xl);
    border-bottom: none;
}

.form-title {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.form-description {
    margin: var(--spacing-sm) 0 0 0;
    opacity: 0.9;
    font-size: 1rem;
}

.form-content {
    padding: var(--spacing-2xl);
}

/* Form Sections */
.form-section {
    background: var(--parliament-light);
    border: 1px solid var(--parliament-border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    position: relative;
}

.form-section-title {
    color: var(--parliament-dark);
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 2px solid var(--parliament-border);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.form-section-title i {
    color: var(--parliament-primary);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.form-group {
    margin-bottom: var(--spacing-lg);
}

/* Form Elements */
.form-label {
    font-weight: 600;
    color: var(--parliament-dark);
    margin-bottom: var(--spacing-md);
    display: block;
    font-size: 0.95rem;
}

.form-label.required::after {
    content: ' *';
    color: var(--parliament-danger);
    font-weight: 700;
}

.form-control, .form-select {
    transition: var(--transition);
    border: 2px solid var(--parliament-border);
    padding: var(--spacing-md);
    font-size: 0.95rem;
    border-radius: var(--border-radius);
    background: var(--parliament-white);
    width: 100%;
}

.form-control:focus, .form-select:focus {
    border-color: var(--parliament-primary);
    box-shadow: 0 0 0 0.2rem rgba(20, 184, 166, 0.25);
    outline: none;
    background: var(--parliament-white);
}

.form-control.is-valid {
    border-color: var(--parliament-success);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2310b981' d='m2.3 6.73.5.5c.2.2.5.2.7 0l2.5-2.5c.2-.2.2-.5 0-.7l-.5-.5c-.2-.2-.5-.2-.7 0l-1.5 1.5-.5-.5c-.2-.2-.5-.2-.7 0l-.5.5c-.2.2-.2.5 0 .7z'/%3e%3c/svg%3e");
}

.form-control.is-invalid {
    border-color: var(--parliament-danger);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23ef4444'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23ef4444' stroke='none'/%3e%3c/svg%3e");
}

.form-text {
    font-size: 0.875rem;
    color: var(--parliament-neutral);
    margin-top: var(--spacing-sm);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.invalid-feedback {
    display: block;
    color: var(--parliament-danger);
    font-size: 0.875rem;
    margin-top: var(--spacing-sm);
    font-weight: 500;
}

.form-check {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--parliament-white);
    border-radius: var(--border-radius);
    border: 1px solid var(--parliament-border-light);
}

.form-check-input {
    width: 1.25rem;
    height: 1.25rem;
    margin: 0;
    accent-color: var(--parliament-primary);
}

.form-check-label {
    font-weight: 500;
    color: var(--parliament-dark);
    cursor: pointer;
    margin: 0;
}

/* Office Type Grid - Visual Selection */
.office-type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--spacing-md);
    margin-top: var(--spacing-lg);
}

.office-type-item {
    border: 2px solid var(--parliament-border);
    border-radius: var(--border-radius);
    padding: var(--spacing-lg);
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    background: var(--parliament-white);
}

.office-type-item:hover {
    border-color: var(--parliament-primary);
    background: #f0fdfa;
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.office-type-item.selected {
    border-color: var(--parliament-primary);
    background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
    box-shadow: var(--shadow-md);
}

.office-type-item.selected::after {
    content: 'âœ“';
    position: absolute;
    top: var(--spacing-sm);
    right: var(--spacing-sm);
    background: var(--parliament-primary);
    color: var(--parliament-white);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: bold;
    box-shadow: var(--shadow-sm);
}

.office-type-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--spacing-md);
    font-size: 1.5rem;
    color: var(--parliament-white);
    transition: var(--transition);
}

.office-type-icon.wing { background: linear-gradient(135deg, #3b82f6, #2563eb); }
.office-type-icon.branch { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
.office-type-icon.section { background: linear-gradient(135deg, #06b6d4, #0891b2); }
.office-type-icon.secretary { background: linear-gradient(135deg, #10b981, #059669); }
.office-type-icon.speaker { background: linear-gradient(135deg, #f59e0b, #d97706); }
.office-type-icon.mp { background: linear-gradient(135deg, #ec4899, #db2777); }
.office-type-icon.other { background: linear-gradient(135deg, #6b7280, #4b5563); }

.office-type-label {
    font-weight: 600;
    color: var(--parliament-dark);
    font-size: 0.95rem;
    margin-bottom: var(--spacing-xs);
}

.office-type-description {
    font-size: 0.8rem;
    color: var(--parliament-neutral);
    line-height: 1.4;
}

/* Code Preview */
.code-preview {
    font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    padding: var(--spacing-md);
    border-radius: var(--border-radius);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--parliament-primary);
    margin-top: var(--spacing-md);
    border: 1px solid var(--parliament-border);
    position: relative;
}

.code-preview::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: var(--parliament-primary);
    border-radius: 0 4px 4px 0;
}

.preview-label {
    font-size: 0.75rem;
    color: var(--parliament-neutral);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--spacing-xs);
    font-weight: 500;
}

/* Form Actions */
.form-actions {
    background: linear-gradient(135deg, #f9fafb, #f3f4f6);
    padding: var(--spacing-xl);
    border-top: 1px solid var(--parliament-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--spacing-md);
}

.btn-group {
    display: flex;
    gap: var(--spacing-md);
}

.btn {
    padding: var(--spacing-md) var(--spacing-xl);
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    transition: var(--transition);
    border: none;
    cursor: pointer;
}

.btn-primary {
    background: linear-gradient(135deg, var(--parliament-primary), var(--parliament-secondary));
    color: var(--parliament-white);
    border: 1px solid var(--parliament-primary);
}

.btn-primary:hover {
    background: linear-gradient(135deg, var(--parliament-secondary), #0d9488);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    color: var(--parliament-white);
    text-decoration: none;
}

.btn-outline-secondary {
    background: var(--parliament-white);
    color: var(--parliament-neutral);
    border: 2px solid var(--parliament-border);
}

.btn-outline-secondary:hover {
    background: var(--parliament-light);
    color: var(--parliament-dark);
    border-color: var(--parliament-neutral);
    text-decoration: none;
}

/* Progress Indicator */
.form-progress {
    background: var(--parliament-white);
    padding: var(--spacing-md) var(--spacing-xl);
    border-bottom: 1px solid var(--parliament-border);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.progress-steps {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex: 1;
}

.progress-step {
    background: var(--parliament-border);
    height: 4px;
    flex: 1;
    border-radius: 2px;
    transition: var(--transition);
}

.progress-step.active {
    background: var(--parliament-primary);
}

.progress-text {
    font-size: 0.875rem;
    color: var(--parliament-neutral);
    font-weight: 500;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .office-type-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
}

@media (max-width: 768px) {
    .office-create-container {
        padding: var(--spacing-md) 0;
    }

    .page-header, .form-container {
        margin: 0 var(--spacing-md);
    }

    .page-header {
        padding: var(--spacing-xl);
    }

    .page-title {
        font-size: 1.5rem;
    }

    .form-content {
        padding: var(--spacing-xl);
    }

    .form-row {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }

    .form-actions {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-md);
    }

    .btn-group {
        justify-content: stretch;
    }

    .btn {
        justify-content: center;
    }

    .office-type-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
    }

    .office-type-item {
        padding: var(--spacing-md);
    }
}

@media (max-width: 480px) {
    .page-header {
        padding: var(--spacing-md);
    }

    .form-content {
        padding: var(--spacing-md);
    }

    .form-section {
        padding: var(--spacing-md);
    }

    .page-title {
        font-size: 1.25rem;
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
    }

    .btn-group {
        flex-direction: column;
    }
}

/* Loading States */
.form-loading {
    opacity: 0.6;
    pointer-events: none;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Focus States for Accessibility */
.office-type-item:focus {
    outline: 2px solid var(--parliament-primary);
    outline-offset: 2px;
}

.btn:focus {
    outline: 2px solid var(--parliament-primary);
    outline-offset: 2px;
}
</style>
{% endblock %}

{% block content %}
<div class="office-create-container">
    <div class="container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="page-title">
                        <i class="bi bi-building-add"></i>
                        {{ page_title }}
                    </h1>
                    <p class="page-subtitle">
                        Create a new office for Bangladesh Parliament Secretariat IT Inventory Management System
                    </p>
                    <nav class="breadcrumb-nav" aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="{% url 'dashboard' %}">
                                    <i class="bi bi-house-door me-1"></i>Dashboard
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'locations:office_list' %}">
                                    <i class="bi bi-buildings me-1"></i>Offices
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">Create Office</li>
                        </ol>
                    </nav>
                </div>
                <div class="text-end">
                    <small class="text-muted d-block">
                        <i class="bi bi-geo-alt me-1"></i>
                        Bangladesh Parliament Secretariat, Dhaka
                    </small>
                    <small class="text-muted">
                        <i class="bi bi-clock me-1"></i>
                        {{ "now"|date:"F j, Y - g:i A" }}
                    </small>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <!-- Progress Indicator -->
            <div class="form-progress">
                <div class="progress-steps">
                    <div class="progress-step active"></div>
                    <div class="progress-step"></div>
                    <div class="progress-step"></div>
                </div>
                <span class="progress-text">Step 1 of 3: Basic Information</span>
            </div>

            <!-- Form Header -->
            <div class="form-header">
                <h2 class="form-title">
                    <i class="bi bi-building-gear"></i>
                    Office Information
                </h2>
                <p class="form-description">
                    Fill in the required information to create a new office. All fields marked with (*) are mandatory.
                </p>
            </div>

            <!-- Form Content -->
            <div class="form-content">
                <form method="post" id="officeForm" novalidate>
                    {% csrf_token %}

                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="bi bi-info-circle"></i>
                            Basic Office Information
                        </h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="{{ form.name.id_for_label }}" class="form-label required">
                                    <i class="bi bi-building me-1"></i>
                                    Office Name
                                </label>
                                {{ form.name }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.name.errors %}
                                            <small class="text-danger">{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Enter the official name of the office
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="{{ form.office_code.id_for_label }}" class="form-label required">
                                    <i class="bi bi-hash me-1"></i>
                                    Office Code
                                </label>
                                {{ form.office_code }}
                                {% if form.office_code.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.office_code.errors %}
                                            <small class="text-danger">{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Unique identifier for the office (e.g., IT-001, SEC-001)
                                </div>
                                <div class="code-preview" id="codePreview" style="display: none;">
                                    <div class="preview-label">Preview:</div>
                                    <span id="codePreviewText"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Office Type Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="bi bi-diagram-3"></i>
                            Office Type & Category
                        </h3>

                        <div class="form-group">
                            <label for="{{ form.office_type.id_for_label }}" class="form-label required">
                                <i class="bi bi-tag me-1"></i>
                                Select Office Type
                            </label>
                            {{ form.office_type }}
                            {% if form.office_type.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.office_type.errors %}
                                        <small class="text-danger">{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>
                                Choose the type that best describes this office
                            </div>

                            <!-- Visual Office Type Selection -->
                            <div class="office-type-grid">
                                <div class="office-type-item" data-type="wing" tabindex="0">
                                    <div class="office-type-icon wing">
                                        <i class="bi bi-diagram-2"></i>
                                    </div>
                                    <div class="office-type-label">Wing Office</div>
                                    <div class="office-type-description">Administrative wing of Parliament</div>
                                </div>
                                <div class="office-type-item" data-type="branch" tabindex="0">
                                    <div class="office-type-icon branch">
                                        <i class="bi bi-diagram-3"></i>
                                    </div>
                                    <div class="office-type-label">Branch Office</div>
                                    <div class="office-type-description">Specialized operational branch</div>
                                </div>
                                <div class="office-type-item" data-type="section" tabindex="0">
                                    <div class="office-type-icon section">
                                        <i class="bi bi-collection"></i>
                                    </div>
                                    <div class="office-type-label">Section Office</div>
                                    <div class="office-type-description">Departmental section office</div>
                                </div>
                                <div class="office-type-item" data-type="secretary" tabindex="0">
                                    <div class="office-type-icon secretary">
                                        <i class="bi bi-person-badge"></i>
                                    </div>
                                    <div class="office-type-label">Secretary Office</div>
                                    <div class="office-type-description">Secretary & high-level administration</div>
                                </div>
                                <div class="office-type-item" data-type="speaker" tabindex="0">
                                    <div class="office-type-icon speaker">
                                        <i class="bi bi-megaphone"></i>
                                    </div>
                                    <div class="office-type-label">Speaker Office</div>
                                    <div class="office-type-description">Speaker & Parliament leadership</div>
                                </div>
                                <div class="office-type-item" data-type="mp" tabindex="0">
                                    <div class="office-type-icon mp">
                                        <i class="bi bi-people"></i>
                                    </div>
                                    <div class="office-type-label">MP Office</div>
                                    <div class="office-type-description">Member of Parliament office</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact & Details Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="bi bi-person-lines-fill"></i>
                            Contact Information & Details
                        </h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="{{ form.head_of_office.id_for_label }}" class="form-label">
                                    <i class="bi bi-person-badge me-1"></i>
                                    Head of Office
                                </label>
                                {{ form.head_of_office }}
                                {% if form.head_of_office.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.head_of_office.errors %}
                                            <small class="text-danger">{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Name of the office head or manager
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="{{ form.contact_number.id_for_label }}" class="form-label">
                                    <i class="bi bi-telephone me-1"></i>
                                    Contact Number
                                </label>
                                {{ form.contact_number }}
                                {% if form.contact_number.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.contact_number.errors %}
                                            <small class="text-danger">{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Official contact number for the office
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    <i class="bi bi-envelope me-1"></i>
                                    Email Address
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.email.errors %}
                                            <small class="text-danger">{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Official email address for the office
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="{{ form.description.id_for_label }}" class="form-label">
                                    <i class="bi bi-card-text me-1"></i>
                                    Description
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.description.errors %}
                                            <small class="text-danger">{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Brief description of the office purpose and functions
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="bi bi-toggle-on"></i>
                            Office Status
                        </h3>

                        <div class="form-check">
                            {{ form.is_active }}
                            <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                                <i class="bi bi-check-circle me-1"></i>
                                Office is currently active and operational
                            </label>
                        </div>
                        {% if form.is_active.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.is_active.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </form>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <div>
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        Required fields are marked with an asterisk (*)
                    </small>
                    <small class="text-muted d-block mt-1">
                        <i class="bi bi-shield-check me-1"></i>
                        All data is encrypted and stored securely
                    </small>
                </div>
                <div class="btn-group">
                    <a href="{% url 'locations:office_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle me-2"></i>
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-primary" onclick="document.querySelector('#officeForm').submit();">
                        <i class="bi bi-plus-circle me-2"></i>
                        {{ form_action }} Office
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const officeCodeInput = document.getElementById('{{ form.office_code.id_for_label }}');
    const officeTypeSelect = document.getElementById('{{ form.office_type.id_for_label }}');
    const codePreview = document.getElementById('codePreview');
    const codePreviewText = document.getElementById('codePreviewText');
    const officeTypeItems = document.querySelectorAll('.office-type-item');
    const form = document.getElementById('officeForm');
    const progressSteps = document.querySelectorAll('.progress-step');
    const progressText = document.querySelector('.progress-text');

    // Progress simulation
    let currentStep = 1;
    const totalSteps = 3;

    function updateProgress(step) {
        progressSteps.forEach((stepEl, index) => {
            if (index < step) {
                stepEl.classList.add('active');
            } else {
                stepEl.classList.remove('active');
            }
        });
        
        const stepNames = ['Basic Information', 'Office Type & Contact', 'Review & Submit'];
        progressText.textContent = `Step ${step} of ${totalSteps}: ${stepNames[step - 1]}`;
    }

    // Office code preview and formatting
    function updateCodePreview() {
        const code = officeCodeInput.value.trim().toUpperCase();
        if (code) {
            codePreviewText.textContent = code;
            codePreview.style.display = 'block';
            updateProgress(2);
        } else {
            codePreview.style.display = 'none';
            updateProgress(1);
        }
    }

    officeCodeInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase().replace(/[^A-Z0-9-]/g, '');
        updateCodePreview();
        validateForm();
    });

    officeCodeInput.addEventListener('keyup', updateCodePreview);

    // Visual office type selection
    function updateOfficeTypeSelection() {
        const selectedType = officeTypeSelect.value;
        
        officeTypeItems.forEach(item => {
            item.classList.remove('selected');
            if (item.dataset.type === selectedType) {
                item.classList.add('selected');
                updateProgress(3);
            }
        });
    }

    officeTypeItems.forEach(item => {
        item.addEventListener('click', function() {
            const type = this.dataset.type;
            officeTypeSelect.value = type;
            updateOfficeTypeSelection();
            validateForm();
            
            // Smooth scroll to next section
            setTimeout(() => {
                const nextSection = this.closest('.form-section').nextElementSibling;
                if (nextSection) {
                    nextSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }
            }, 300);
        });

        // Keyboard navigation
        item.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
    });

    officeTypeSelect.addEventListener('change', function() {
        updateOfficeTypeSelection();
        validateForm();
    });

    // Form validation
    function validateForm() {
        const requiredFields = [
            officeCodeInput,
            document.getElementById('{{ form.name.id_for_label }}'),
            officeTypeSelect
        ];

        let isValid = true;
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
            }
        });

        const submitBtn = document.querySelector('.btn-primary');
        if (isValid) {
            submitBtn.removeAttribute('disabled');
            submitBtn.style.opacity = '1';
        } else {
            submitBtn.setAttribute('disabled', 'true');
            submitBtn.style.opacity = '0.6';
        }
    }

    // Real-time validation on input
    const formInputs = form.querySelectorAll('input, select, textarea');
    formInputs.forEach(input => {
        input.addEventListener('input', validateForm);
        input.addEventListener('change', validateForm);
    });

    // Form submission with loading state
    form.addEventListener('submit', function(e) {
        const submitBtn = document.querySelector('.btn-primary');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Creating Office...';
        submitBtn.setAttribute('disabled', 'true');
        
        // Add loading class to form
        form.classList.add('form-loading');
        
        // If validation fails, restore button
        setTimeout(() => {
            if (!form.checkValidity()) {
                submitBtn.innerHTML = originalText;
                submitBtn.removeAttribute('disabled');
                form.classList.remove('form-loading');
            }
        }, 100);
    });

    // Auto-save functionality (optional)
    let autoSaveTimeout;
    function autoSave() {
        clearTimeout(autoSaveTimeout);
        autoSaveTimeout = setTimeout(() => {
            const formData = new FormData(form);
            // Here you could implement auto-save to localStorage or server
            console.log('Form data auto-saved');
        }, 2000);
    }

    formInputs.forEach(input => {
        input.addEventListener('input', autoSave);
    });

    // Enhanced accessibility
    const requiredInputs = document.querySelectorAll('input[required], select[required]');
    requiredInputs.forEach(input => {
        input.setAttribute('aria-required', 'true');
    });

    // Tooltip functionality for help icons
    const helpIcons = document.querySelectorAll('.form-text i.bi-info-circle');
    helpIcons.forEach(icon => {
        icon.style.cursor = 'help';
        icon.setAttribute('title', 'Click for more information');
    });

    // Initialize
    updateOfficeTypeSelection();
    validateForm();
    updateProgress(1);

    // Smooth animations for office type selection
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });

    officeTypeItems.forEach(item => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(item);
    });

    // Add ripple effect to buttons
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            `;
            
            this.style.position = 'relative';
            this.style.overflow = 'hidden';
            this.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 600);
        });
    });

    // CSS for ripple animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes ripple {
            to {
                transform: scale(2);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}