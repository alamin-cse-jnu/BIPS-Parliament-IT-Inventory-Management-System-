{% extends 'base.html' %}
{% load static %}

{% block title %}Create Device Subcategory - PIMS - Bangladesh Parliament Secretariat{% endblock %}

{% block breadcrumb_items %}
    <li class="breadcrumb-item"><a href="{% url 'devices:list' %}">Devices</a></li>
    <li class="breadcrumb-item"><a href="{% url 'devices:subcategory_list' %}">Subcategories</a></li>
    <li class="breadcrumb-item active">Create New</li>
{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
/* Device Subcategory Create Form - Parliament Design System */
/* Location: Bangladesh Parliament Secretariat, Dhaka, Bangladesh */
/* Flat Design with High Contrast - Teal, Orange, Red Color Scheme */

:root {
    --primary-teal: #14b8a6;
    --primary-teal-hover: #0f9488;
    --primary-orange: #f97316;
    --primary-red: #ef4444;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --border-light: #e2e8f0;
    --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --radius-lg: 16px;
    --radius-md: 12px;
    --radius-sm: 8px;
}

/* Main Container */
.create-container {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, #e2e8f0 100%);
    min-height: 100vh;
    padding: 2rem 0;
}

/* Page Header */
.page-header {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-card);
}

.page-title {
    color: var(--text-primary);
    font-weight: 700;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 2rem;
}

.page-subtitle {
    color: var(--text-secondary);
    margin-bottom: 0;
    font-size: 1.125rem;
}

.breadcrumb-nav {
    background: transparent;
    padding: 0;
    margin-bottom: 1rem;
}

.breadcrumb-nav .breadcrumb {
    background: rgba(20, 184, 166, 0.1);
    border-radius: var(--radius-sm);
    padding: 0.75rem 1rem;
    margin: 0;
}

.breadcrumb-item + .breadcrumb-item::before {
    content: 'â€º';
    color: var(--primary-teal);
    font-weight: bold;
}

.breadcrumb-item a {
    color: var(--primary-teal);
    text-decoration: none;
    font-weight: 500;
}

.breadcrumb-item.active {
    color: var(--text-primary);
    font-weight: 600;
}

/* Form Container */
.form-container {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-card);
    overflow: hidden;
}

.form-header {
    background: linear-gradient(135deg, var(--primary-teal) 0%, var(--primary-teal-hover) 100%);
    color: white;
    padding: 1.5rem 2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.form-body {
    padding: 2rem;
}

/* Field Groups */
.field-group {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(248, 250, 252, 0.6);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
}

.field-group-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    font-size: 1.125rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--primary-teal);
}

.field-group-title i {
    color: var(--primary-teal);
    font-size: 1.25rem;
}

/* Form Fields */
.form-label {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-label .text-danger {
    color: var(--primary-red);
}

.form-control, .form-select {
    border: 2px solid var(--border-light);
    border-radius: var(--radius-sm);
    padding: 0.75rem 1rem;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: var(--bg-primary);
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-teal);
    box-shadow: 0 0 0 0.2rem rgba(20, 184, 166, 0.25);
    outline: none;
}

.form-control.is-invalid, .form-select.is-invalid {
    border-color: var(--primary-red);
}

.invalid-feedback {
    color: var(--primary-red);
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: block;
}

.help-text {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-top: 0.5rem;
    line-height: 1.4;
}

/* Preview Card */
.preview-container {
    position: sticky;
    top: 2rem;
}

.preview-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-card);
    margin-bottom: 1.5rem;
    text-align: center;
}

.preview-header {
    background: linear-gradient(135deg, var(--primary-orange) 0%, #ea580c 100%);
    color: white;
    padding: 1rem;
    margin: -2rem -2rem 1.5rem -2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-weight: 600;
}

.category-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-teal), var(--primary-teal-hover));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 2rem;
    color: white;
    box-shadow: var(--shadow-card);
}

.preview-name {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.code-preview {
    background: rgba(20, 184, 166, 0.1);
    color: var(--primary-teal);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
    font-family: 'Courier New', monospace;
    font-weight: 600;
    margin-bottom: 1rem;
    display: inline-block;
}

.preview-description {
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 1rem;
}

.badge {
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    font-weight: 500;
    margin: 0.25rem;
}

.badge.bg-primary {
    background: var(--primary-teal) !important;
}

.badge.bg-success {
    background: var(--success) !important;
}

.badge.bg-secondary {
    background: var(--text-secondary) !important;
}

/* Examples Section */
.examples-section {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-card);
}

.examples-header {
    background: linear-gradient(135deg, var(--success) 0%, #047857 100%);
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
}

.examples-body {
    padding: 1.5rem;
}

.example-item {
    background: rgba(16, 185, 129, 0.05);
    border: 1px solid rgba(16, 185, 129, 0.2);
    border-radius: var(--radius-sm);
    padding: 1rem;
    margin-bottom: 1rem;
}

.example-item:last-child {
    margin-bottom: 0;
}

.example-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.example-desc {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
}

.example-code {
    background: var(--text-primary);
    color: #10b981;
    padding: 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
}

/* Form Actions */
.form-actions {
    background: rgba(248, 250, 252, 0.8);
    border-top: 1px solid var(--border-light);
    padding: 1.5rem 2rem;
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-sm);
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-teal) 0%, var(--primary-teal-hover) 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.btn-outline-secondary {
    background: transparent;
    border: 2px solid var(--border-light);
    color: var(--text-secondary);
}

.btn-outline-secondary:hover {
    background: var(--text-secondary);
    color: white;
    text-decoration: none;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .main-row {
        flex-direction: column;
    }
    
    .preview-container {
        position: static;
        margin-top: 2rem;
    }
}

@media (max-width: 768px) {
    .create-container {
        padding: 1rem 0;
    }
    
    .page-header {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .page-title {
        font-size: 1.5rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .form-body {
        padding: 1.5rem;
    }
    
    .field-group {
        padding: 1rem;
    }
    
    .form-actions {
        padding: 1rem 1.5rem;
        flex-direction: column;
    }
    
    .preview-card {
        padding: 1.5rem;
    }
    
    .category-icon {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }
}

/* Animation for smooth interactions */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-container, .preview-card, .examples-section {
    animation: fadeInUp 0.6s ease-out;
}

/* Focus and accessibility improvements */
.form-control:focus-visible,
.form-select:focus-visible,
.btn:focus-visible {
    outline: 2px solid var(--primary-teal);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .form-container,
    .preview-card,
    .examples-section {
        border-width: 2px;
    }
    
    .btn-primary {
        border: 2px solid var(--primary-teal-hover);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="create-container">
    <div class="container-fluid">
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb-nav" aria-label="breadcrumb">
            <ol class="breadcrumb">
                {% for item in breadcrumb_items %}
                    {% if not forloop.last %}
                        <li class="breadcrumb-item">
                            <a href="{{ item.url }}">{{ item.title }}</a>
                        </li>
                    {% else %}
                        <li class="breadcrumb-item active" aria-current="page">{{ item.title }}</li>
                    {% endif %}
                {% endfor %}
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="page-title">
                        <i class="bi bi-plus-circle"></i>
                        Create Device Subcategory
                    </h1>
                    <p class="page-subtitle">
                        Add a new subcategory to organize device types within the Bangladesh Parliament IT inventory system
                    </p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <div class="text-muted">
                        <i class="bi bi-geo-alt me-1"></i>
                        <strong>Location:</strong> Dhaka, Bangladesh
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row main-row">
            <!-- Create Form -->
            <div class="col-lg-8">
                <div class="form-container">
                    <div class="form-header">
                        <i class="bi bi-plus-circle"></i>
                        <span>Subcategory Information</span>
                    </div>
                    
                    <div class="form-body">
                        <form method="post" novalidate id="subcategoryForm">
                            {% csrf_token %}
                            
                            <!-- Basic Information -->
                            <div class="field-group">
                                <div class="field-group-title">
                                    <i class="bi bi-info-circle"></i>
                                    Basic Information
                                </div>
                                
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="{{ form.category.id_for_label }}" class="form-label">
                                            Parent Category <span class="text-danger">*</span>
                                        </label>
                                        {{ form.category }}
                                        {% if form.category.errors %}
                                            <div class="invalid-feedback d-block">{{ form.category.errors.0 }}</div>
                                        {% endif %}
                                        <div class="help-text">
                                            Select the main category this subcategory belongs to
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label for="{{ form.name.id_for_label }}" class="form-label">
                                                Subcategory Name <span class="text-danger">*</span>
                                            </label>
                                            {{ form.name }}
                                            {% if form.name.errors %}
                                                <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
                                            {% endif %}
                                            <div class="help-text">
                                                Enter a clear, descriptive name for this subcategory
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="{{ form.code.id_for_label }}" class="form-label">
                                                Code <span class="text-danger">*</span>
                                            </label>
                                            {{ form.code }}
                                            {% if form.code.errors %}
                                                <div class="invalid-feedback d-block">{{ form.code.errors.0 }}</div>
                                            {% endif %}
                                            <div class="help-text">
                                                Unique identifier (e.g., LAP, DES, SRV)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="{{ form.description.id_for_label }}" class="form-label">
                                                Description
                                            </label>
                                            {{ form.description }}
                                            {% if form.description.errors %}
                                                <div class="invalid-feedback d-block">{{ form.description.errors.0 }}</div>
                                            {% endif %}
                                            <div class="help-text">
                                                Detailed description of what devices belong in this subcategory
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Display & Organization -->
                            <div class="field-group">
                                <div class="field-group-title">
                                    <i class="bi bi-palette"></i>
                                    Display & Organization
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="{{ form.icon.id_for_label }}" class="form-label">
                                                Icon
                                            </label>
                                            {{ form.icon }}
                                            {% if form.icon.errors %}
                                                <div class="invalid-feedback d-block">{{ form.icon.errors.0 }}</div>
                                            {% endif %}
                                            <div class="help-text">
                                                Bootstrap icon class (e.g., bi-laptop, bi-desktop)
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="{{ form.sort_order.id_for_label }}" class="form-label">
                                                Sort Order
                                            </label>
                                            {{ form.sort_order }}
                                            {% if form.sort_order.errors %}
                                                <div class="invalid-feedback d-block">{{ form.sort_order.errors.0 }}</div>
                                            {% endif %}
                                            <div class="help-text">
                                                Display order (lower numbers first)
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <div class="form-check">
                                                {{ form.is_active }}
                                                <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                                                    Active Status
                                                </label>
                                                {% if form.is_active.errors %}
                                                    <div class="invalid-feedback d-block">{{ form.is_active.errors.0 }}</div>
                                                {% endif %}
                                            </div>
                                            <div class="help-text">
                                                Enable this subcategory for use
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <a href="{% url 'devices:subcategory_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i>
                            Cancel
                        </a>
                        <button type="submit" form="subcategoryForm" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i>
                            Create Subcategory
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview and Help -->
            <div class="col-lg-4">
                <div class="preview-container">
                    <!-- Live Preview -->
                    <div class="preview-card">
                        <div class="preview-header">
                            <i class="bi bi-eye"></i>
                            Live Preview
                        </div>
                        
                        <div class="category-icon" id="iconPreview">
                            <i class="bi-laptop" id="previewIcon"></i>
                        </div>
                        
                        <h6 class="preview-name" id="previewName">Subcategory Name</h6>
                        
                        <div class="code-preview" id="previewCode">CATEGORY-CODE</div>
                        
                        <p class="preview-description" id="previewDescription">
                            Subcategory description will appear here
                        </p>
                        
                        <!-- Category Badge -->
                        <div class="mb-3">
                            <span class="badge bg-primary" id="previewCategoryBadge">
                                Select Category
                            </span>
                        </div>
                        
                        <!-- Status Preview -->
                        <div class="d-flex justify-content-center gap-2">
                            <span class="badge bg-success" id="statusBadge">Active</span>
                            <span class="badge bg-secondary">Sort: <span id="sortPreview">0</span></span>
                        </div>
                    </div>

                    <!-- Examples -->
                    <div class="examples-section">
                        <div class="examples-header">
                            <i class="bi bi-lightbulb"></i>
                            Examples
                        </div>
                        <div class="examples-body">
                            <div class="example-item">
                                <div class="example-title">Laptops</div>
                                <div class="example-desc">Portable computing devices</div>
                                <div class="example-code">LAP</div>
                            </div>
                            
                            <div class="example-item">
                                <div class="example-title">Desktop Computers</div>
                                <div class="example-desc">Fixed workstation computers</div>
                                <div class="example-code">DES</div>
                            </div>
                            
                            <div class="example-item">
                                <div class="example-title">Servers</div>
                                <div class="example-desc">Network and data servers</div>
                                <div class="example-code">SRV</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Live Preview Functionality for Device Subcategory Creation
// Location: Bangladesh Parliament Secretariat, Dhaka, Bangladesh
(function() {
    'use strict';
    
    // Preview elements
    const previewName = document.getElementById('previewName');
    const previewCode = document.getElementById('previewCode');
    const previewDescription = document.getElementById('previewDescription');
    const previewIcon = document.getElementById('previewIcon');
    const previewCategoryBadge = document.getElementById('previewCategoryBadge');
    const statusBadge = document.getElementById('statusBadge');
    const sortPreview = document.getElementById('sortPreview');
    
    // Form fields
    const nameField = document.querySelector('input[name="name"]');
    const codeField = document.querySelector('input[name="code"]');
    const descriptionField = document.querySelector('textarea[name="description"]');
    const iconField = document.querySelector('input[name="icon"]');
    const categoryField = document.querySelector('select[name="category"]');
    const isActiveField = document.querySelector('input[name="is_active"]');
    const sortOrderField = document.querySelector('input[name="sort_order"]');
    
    // Update preview function
    function updatePreview() {
        // Update name
        if (nameField?.value.trim()) {
            previewName.textContent = nameField.value.trim();
        } else {
            previewName.textContent = 'Subcategory Name';
        }
        
        // Update code
        if (codeField?.value.trim()) {
            previewCode.textContent = codeField.value.trim().toUpperCase();
        } else {
            previewCode.textContent = 'CATEGORY-CODE';
        }
        
        // Update description
        if (descriptionField?.value.trim()) {
            previewDescription.textContent = descriptionField.value.trim();
        } else {
            previewDescription.textContent = 'Subcategory description will appear here';
        }
        
        // Update icon
        if (iconField?.value.trim()) {
            const iconClass = iconField.value.trim();
            // Remove any existing icon classes and add the new one
            previewIcon.className = '';
            previewIcon.classList.add(iconClass.startsWith('bi-') ? iconClass : 'bi-' + iconClass);
        } else {
            previewIcon.className = 'bi-laptop';
        }
        
        // Update category badge
        if (categoryField?.selectedOptions[0]?.text) {
            previewCategoryBadge.textContent = categoryField.selectedOptions[0].text;
        } else {
            previewCategoryBadge.textContent = 'Select Category';
        }
        
        // Update status badge
        if (isActiveField?.checked) {
            statusBadge.textContent = 'Active';
            statusBadge.className = 'badge bg-success';
        } else {
            statusBadge.textContent = 'Inactive';
            statusBadge.className = 'badge bg-secondary';
        }
        
        // Update sort order
        if (sortOrderField?.value) {
            sortPreview.textContent = sortOrderField.value;
        } else {
            sortPreview.textContent = '0';
        }
    }
    
    // Auto-generate code from name
    function generateCodeFromName() {
        if (nameField?.value && !codeField?.value) {
            const name = nameField.value.trim();
            let code = '';
            
            // Extract first letters of each word
            const words = name.split(/\s+/);
            if (words.length === 1) {
                // Single word - take first 3 characters
                code = words[0].substring(0, 3).toUpperCase();
            } else {
                // Multiple words - take first letter of each word
                code = words.map(word => word.charAt(0)).join('').toUpperCase();
                // Limit to 4 characters
                code = code.substring(0, 4);
            }
            
            codeField.value = code;
            updatePreview();
        }
    }
    
    // Add event listeners
    if (nameField) {
        nameField.addEventListener('input', updatePreview);
        nameField.addEventListener('blur', generateCodeFromName);
    }
    
    if (codeField) {
        codeField.addEventListener('input', updatePreview);
    }
    
    if (descriptionField) {
        descriptionField.addEventListener('input', updatePreview);
    }
    
    if (iconField) {
        iconField.addEventListener('input', updatePreview);
    }
    
    if (categoryField) {
        categoryField.addEventListener('change', updatePreview);
    }
    
    if (isActiveField) {
        isActiveField.addEventListener('change', updatePreview);
    }
    
    if (sortOrderField) {
        sortOrderField.addEventListener('input', updatePreview);
    }
    
    // Form validation enhancements
    const form = document.getElementById('subcategoryForm');
    
    if (form) {
        form.addEventListener('submit', function(e) {
            let isValid = true;
            
            // Clear previous validation states
            const fields = form.querySelectorAll('.form-control, .form-select');
            fields.forEach(field => {
                field.classList.remove('is-invalid');
                const feedback = field.parentElement.querySelector('.invalid-feedback');
                if (feedback && !feedback.classList.contains('d-block')) {
                    feedback.style.display = 'none';
                }
            });
            
            // Validate required fields
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                    
                    // Show or create error message
                    let feedback = field.parentElement.querySelector('.invalid-feedback');
                    if (!feedback) {
                        feedback = document.createElement('div');
                        feedback.className = 'invalid-feedback';
                        field.parentElement.appendChild(feedback);
                    }
                    feedback.textContent = 'This field is required.';
                    feedback.style.display = 'block';
                }
            });
            
            // Validate code format (alphanumeric, 2-6 characters)
            if (codeField?.value) {
                const codePattern = /^[A-Z0-9]{2,6}$/;
                if (!codePattern.test(codeField.value.trim())) {
                    codeField.classList.add('is-invalid');
                    isValid = false;
                    
                    let feedback = codeField.parentElement.querySelector('.invalid-feedback');
                    if (!feedback) {
                        feedback = document.createElement('div');
                        feedback.className = 'invalid-feedback';
                        codeField.parentElement.appendChild(feedback);
                    }
                    feedback.textContent = 'Code must be 2-6 uppercase letters/numbers only.';
                    feedback.style.display = 'block';
                }
            }
            
            if (!isValid) {
                e.preventDefault();
                
                // Scroll to first error
                const firstError = form.querySelector('.is-invalid');
                if (firstError) {
                    firstError.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                    firstError.focus();
                }
                
                // Show error notification
                showNotification('Please correct the errors below before submitting.', 'error');
            }
        });
    }
    
    // Icon suggestions
    const iconSuggestions = [
        'bi-laptop', 'bi-pc-display', 'bi-server', 'bi-phone', 'bi-tablet',
        'bi-printer', 'bi-projector', 'bi-camera', 'bi-headphones',
        'bi-keyboard', 'bi-mouse', 'bi-display', 'bi-cpu', 'bi-memory',
        'bi-hdd', 'bi-usb-drive', 'bi-router', 'bi-wifi'
    ];
    
    // Add icon autocomplete functionality
    if (iconField) {
        const iconDatalist = document.createElement('datalist');
        iconDatalist.id = 'iconSuggestions';
        iconSuggestions.forEach(icon => {
            const option = document.createElement('option');
            option.value = icon;
            iconDatalist.appendChild(option);
        });
        iconField.setAttribute('list', 'iconSuggestions');
        iconField.parentElement.appendChild(iconDatalist);
    }
    
    // Notification system
    function showNotification(message, type = 'info') {
        // Remove existing notifications
        const existing = document.querySelector('.notification-toast');
        if (existing) {
            existing.remove();
        }
        
        const toast = document.createElement('div');
        toast.className = `notification-toast alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show`;
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        `;
        
        toast.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(toast);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (toast.parentElement) {
                toast.remove();
            }
        }, 5000);
    }
    
    // Initialize preview on page load
    updatePreview();
    
    // Code field uppercase transformation
    if (codeField) {
        codeField.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
    }
    
    // Real-time icon preview in field
    if (iconField) {
        const iconPreviewInField = document.createElement('i');
        iconPreviewInField.style.cssText = `
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-teal);
            pointer-events: none;
            z-index: 5;
        `;
        
        iconField.parentElement.style.position = 'relative';
        iconField.parentElement.appendChild(iconPreviewInField);
        iconField.style.paddingRight = '40px';
        
        function updateIconPreviewInField() {
            const iconClass = iconField.value.trim();
            if (iconClass) {
                iconPreviewInField.className = iconClass.startsWith('bi-') ? iconClass : 'bi-' + iconClass;
                iconPreviewInField.style.display = 'block';
            } else {
                iconPreviewInField.style.display = 'none';
            }
        }
        
        iconField.addEventListener('input', updateIconPreviewInField);
        updateIconPreviewInField();
    }
    
    // Enhanced form field animations
    const formControls = document.querySelectorAll('.form-control, .form-select');
    formControls.forEach(control => {
        control.addEventListener('focus', function() {
            this.parentElement.style.transform = 'scale(1.02)';
            this.parentElement.style.transition = 'transform 0.2s ease';
        });
        
        control.addEventListener('blur', function() {
            this.parentElement.style.transform = 'scale(1)';
        });
    });
    
    // Category field enhancement
    if (categoryField) {
        categoryField.addEventListener('change', function() {
            if (this.value) {
                // Simulate loading subcategory count or other related data
                const categoryText = this.selectedOptions[0].text;
                console.log(`Selected category: ${categoryText}`);
                
                // You could add an API call here to get category-specific information
                // For example: fetchCategoryInfo(this.value);
            }
        });
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + S to save
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            const submitBtn = document.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.click();
            }
        }
        
        // Escape to cancel
        if (e.key === 'Escape') {
            const cancelBtn = document.querySelector('.btn-outline-secondary');
            if (cancelBtn && confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                window.location.href = cancelBtn.href;
            }
        }
    });
    
    // Save draft functionality (using localStorage)
    function saveDraft() {
        const formData = new FormData(form);
        const draftData = {};
        for (let [key, value] of formData.entries()) {
            draftData[key] = value;
        }
        localStorage.setItem('subcategory_draft', JSON.stringify(draftData));
    }
    
    function loadDraft() {
        const draft = localStorage.getItem('subcategory_draft');
        if (draft) {
            try {
                const draftData = JSON.parse(draft);
                Object.keys(draftData).forEach(key => {
                    const field = form.querySelector(`[name="${key}"]`);
                    if (field) {
                        if (field.type === 'checkbox') {
                            field.checked = draftData[key] === 'on';
                        } else {
                            field.value = draftData[key];
                        }
                    }
                });
                updatePreview();
                showNotification('Draft data restored.', 'info');
            } catch (e) {
                console.error('Error loading draft:', e);
            }
        }
    }
    
    // Auto-save draft every 30 seconds
    if (form) {
        setInterval(saveDraft, 30000);
        
        // Load draft on page load if form is empty
        const isEmpty = !nameField?.value && !codeField?.value && !descriptionField?.value;
        if (isEmpty) {
            loadDraft();
        }
        
        // Clear draft on successful submission
        form.addEventListener('submit', function() {
            localStorage.removeItem('subcategory_draft');
        });
    }
    
})();
</script>
{% endblock %}